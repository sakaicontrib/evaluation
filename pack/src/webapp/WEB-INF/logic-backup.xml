<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<!-- Aaron Zeckoski (aaronz@vt.edu) -->
<!-- some of these beans access Sakai services directly -->
<beans>

    <!-- email notifications -->
    <bean id="org.sakaiproject.evaluation.logic.EvalEmailsLogic"
        class="org.sakaiproject.evaluation.logic.EvalEmailsLogicImpl"
        init-method="init">
        <property name="commonLogic"
            ref="org.sakaiproject.evaluation.logic.EvalCommonLogic" />
        <property name="dao" ref="org.sakaiproject.evaluation.dao.EvaluationDao" />
        <property name="settings" ref="org.sakaiproject.evaluation.logic.EvalSettings" />
        <property name="evaluationService"
            ref="org.sakaiproject.evaluation.logic.EvalEvaluationService" />
        <property name="externalLogic"
    		ref="org.sakaiproject.evaluation.logic.externals.EvalExternalLogic" />
    </bean>
    
    <bean id="org.sakaiproject.evaluation.logic.EvalSingleEmailLogic"
    	class="org.sakaiproject.evaluation.logic.EvalSingleEmailLogicImpl"
    	init-method="init">
    	<property name="commonLogic"
            ref="org.sakaiproject.evaluation.logic.EvalCommonLogic" />
        <property name="dao" ref="org.sakaiproject.evaluation.dao.EvaluationDao" />
        <property name="evaluationService"
            ref="org.sakaiproject.evaluation.logic.EvalEvaluationService" />
        <property name="externalLogic"
    		ref="org.sakaiproject.evaluation.logic.externals.EvalExternalLogic" />
        <property name="settings" ref="org.sakaiproject.evaluation.logic.EvalSettings" />
    </bean>

    <!-- jobs processing -->
    <bean id="org.sakaiproject.evaluation.logic.EvalJobLogic"
    	class="org.sakaiproject.evaluation.logic.scheduling.EvalJobLogicImpl" >
        <property name="commonLogic"
            ref="org.sakaiproject.evaluation.logic.EvalCommonLogic" />
        <property name="evaluationService"
            ref="org.sakaiproject.evaluation.logic.EvalEvaluationService" />
        <property name="settings" ref="org.sakaiproject.evaluation.logic.EvalSettings" />
        <property name="emails" ref="org.sakaiproject.evaluation.logic.EvalEmailsLogic" />
    </bean>
    
   <!-- job to consolidate email notifications for active evaluations -->
   <bean id="evalSingleEmailImpl"
   		class="org.sakaiproject.evaluation.logic.scheduling.EvalSingleEmailImpl"
   		init-method="init" destroy-method="destroy">
   		<property name="evalEmailsLogic">
   			<ref bean="org.sakaiproject.evaluation.logic.EvalEmailsLogic"/>
   		</property>
   		<property name="evalSettings">
   			<ref bean="org.sakaiproject.evaluation.logic.EvalSettings"/>
   		</property>
   		<property name="evaluationService"
            ref="org.sakaiproject.evaluation.logic.EvalEvaluationService" />
   	</bean>
    
   <!-- this is the helper that will register the above bean with the job scheduler -->
   <bean id="org.sakaiproject.api.app.scheduler.JobBeanWrapper.EvalSingleEmailImpl"
      class="org.sakaiproject.component.app.scheduler.jobs.SpringJobBeanWrapper"
      singleton="true" init-method="init">
      <property name="beanId">
      	<value>evalSingleEmailImpl</value>
      </property>
      <property name="jobName">
         <value>Single Email Evaluation Notification</value>
      </property>
      <property name="schedulerManager">
         <ref bean="org.sakaiproject.api.app.scheduler.SchedulerManager" />
      </property>
   </bean>
   
   <!-- jobs to enable and disable sending queued email notifications -->
    	<bean id="enableSendingQueuedEmail"
   		class="org.sakaiproject.evaluation.logic.scheduling.EvalEnableSendingQueuedEmail"
   		init-method="init" destroy-method="destroy">
   		<property name="evalSettings">
   			<ref bean="org.sakaiproject.evaluation.logic.EvalSettings"/>
   		</property>
      	</bean>

  	<bean id="disableSendingQueuedEmail"
   		class="org.sakaiproject.evaluation.logic.scheduling.EvalDisableSendingQueuedEmail"
   		init-method="init" destroy-method="destroy">
   		<property name="evalSettings">
   			<ref bean="org.sakaiproject.evaluation.logic.EvalSettings"/>
   		</property>
   	</bean>
   	
   	<!-- these are the helpers that will register the above beans with the job scheduler -->
   	 <bean id="org.sakaiproject.api.app.scheduler.JobBeanWrapper.EvalEnableSendingQueuedEmail"
      class="org.sakaiproject.component.app.scheduler.jobs.SpringJobBeanWrapper"
      singleton="true" init-method="init">
      <property name="beanId">
      	<value>enableSendingQueuedEmail</value>
      </property>
      <property name="jobName">
         <value>Enable Sending Queued TQ Email</value>
      </property>
      <property name="schedulerManager">
         <ref bean="org.sakaiproject.api.app.scheduler.SchedulerManager" />
      </property>
   </bean>

  <bean id="org.sakaiproject.api.app.scheduler.JobBeanWrapper.EvalDisableSendingQueuedEmail"
      class="org.sakaiproject.component.app.scheduler.jobs.SpringJobBeanWrapper"
      singleton="true" init-method="init">
      <property name="beanId">
      	<value>disableSendingQueuedEmail</value>
      </property>
      <property name="jobName">
         <value>Disable Sending Queued TQ Email</value>
      </property>
      <property name="schedulerManager">
         <ref bean="org.sakaiproject.api.app.scheduler.SchedulerManager" />
      </property>
   </bean>

    <!-- imports -->
    <!-- REMOVED for now to fix circular dependencies, and to get rid of beans that make invalid direct use of Sakai -AZ -->
    <bean id="org.sakaiproject.evaluation.logic.imports.EvalImport"
    	class="org.sakaiproject.evaluation.logic.imports.EvalImportImpl"
    	init-method="init">
    	<property name="authoringService"
    		ref="org.sakaiproject.evaluation.logic.EvalAuthoringService" />
    	<property name="dao" 
    		ref="org.sakaiproject.evaluation.dao.EvaluationDao" />
    	<property name="commonLogic"
    		ref="org.sakaiproject.evaluation.logic.EvalCommonLogic" />
    	<property name="externalLogic"
    		ref="org.sakaiproject.evaluation.logic.externals.EvalExternalLogic" />
    	<property name="evaluationService"
    		ref="org.sakaiproject.evaluation.logic.EvalEvaluationService" />
    	<property name="evaluationSetupService"
    		ref="org.sakaiproject.evaluation.logic.EvalEvaluationSetupService" />
    </bean>

    <bean id="org.sakaiproject.evaluation.logic.imports.EvalImportLogic"
    	class="org.sakaiproject.evaluation.logic.imports.EvalImportLogicImpl"
    	init-method="init">
     	<property name="externalLogic"
    		ref="org.sakaiproject.evaluation.logic.externals.EvalExternalLogic" />
    	<property name="evalImport"
    		ref="org.sakaiproject.evaluation.logic.imports.EvalImport" />
    </bean>

</beans>
