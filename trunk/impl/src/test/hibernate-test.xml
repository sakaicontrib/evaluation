<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

   <!-- read in the hibernate.properties file properties -->
   <bean id="testPropertiesConfigurer"
      class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
      <property name="locations">
         <list>
            <value>classpath:/hibernate.properties</value>
         </list>
      </property>
   </bean>

   <!-- create a data source -->
   <bean id="testDataSource"
      class="org.springframework.jdbc.datasource.DriverManagerDataSource">
      <property name="driverClassName">
         <value>${hibernate.connection.driver_class}</value>
      </property>
      <property name="url">
         <value>${hibernate.connection.url}</value>
      </property>
      <property name="username">
         <value>${hibernate.connection.username}</value>
      </property>
      <property name="password">
         <value>${hibernate.connection.password}</value>
      </property>
   </bean>

   <!-- create a SessionFactory bean from the data source and point it at our HBMs,
      name it the same as the Sakai global one so we can reuse our other spring files -->
   <bean id="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory"
      class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
      <property name="dataSource">
         <ref local="testDataSource" />
      </property>
      <property name="mappingResources">
         <list>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalAdhocGroup.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalAdhocUser.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalAnswer.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalAssignGroup.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalAssignHierarchy.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalConfig.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalEmailTemplate.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalEvaluation.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalGroupNodes.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalItem.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalItemGroup.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalLock.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalResponse.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalScale.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalTemplate.hbm.xml</value>
            <value>org/sakaiproject/evaluation/dao/hbm/EvalTemplateItem.hbm.xml</value>
         </list>
      </property>
      <property name="hibernateProperties">
         <props>
            <prop key="hibernate.dialect">${hibernate.dialect}</prop>
            <prop key="hibernate.show_sql">${hibernate.show_sql}</prop>
            <prop key="hibernate.cache.provider_class">
               ${hibernate.cache.provider_class}
            </prop>
            <prop key="hibernate.query.substitutions">true 1, false 0</prop>
            <prop key="hibernate.hbm2ddl.auto">${hibernate.hbm2ddl.auto}</prop>
         </props>
      </property>
   </bean>

   <!-- Create a transaction manager from the SessionFactory,
      name it the same as the Sakai one so we can reuse our other spring config files -->
   <bean id="org.sakaiproject.springframework.orm.hibernate.GlobalTransactionManager"
      class="org.springframework.orm.hibernate3.HibernateTransactionManager">
      <property name="sessionFactory"
         ref="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory" />
   </bean>

   <!-- Now do the TEST data preloading -->

   <!-- create a test data preloading bean -->
   <bean id="org.sakaiproject.evaluation.test.PreloadTestData"
      class="org.sakaiproject.evaluation.test.PreloadTestDataImpl" init-method="init">
      <property name="evaluationDao" ref="org.sakaiproject.evaluation.dao.EvaluationDao" />
      <property name="preloadData" ref="org.sakaiproject.evaluation.dao.PreloadData" />
   </bean>

   <!-- fake external logic bean -->
   <bean id="org.sakaiproject.evaluation.logic.externals.EvalExternalLogic"
      class="org.sakaiproject.evaluation.test.mocks.MockEvalExternalLogic">
   </bean>

   <!-- fake external hierarchy bean -->
   <bean id="org.sakaiproject.evaluation.logic.externals.ExternalHierarchyLogic"
      class="org.sakaiproject.evaluation.test.mocks.MockExternalHierarchyLogic">
   </bean>

</beans>