<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright 2005 Sakai Foundation Licensed under the
    Educational Community License, Version 2.0 (the "License"); you may
    not use this file except in compliance with the License. You may
    obtain a copy of the License at

    http://www.osedu.org/licenses/ECL-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an "AS IS"
    BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
    or implied. See the License for the specific language governing
    permissions and limitations under the License.

-->
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!-- read in the hibernate.properties file properties -->
    <bean id="testPropertiesConfigurer" 
            class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="locations">
            <list>
                <value>classpath:/hibernate.properties</value>
            </list>
        </property>
    </bean>

    <!-- create a data source (use the name Sakai uses) -->
    <bean id="javax.sql.DataSource" 
            class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName"><value>${hibernate.connection.driver_class}</value></property>
        <property name="url"><value>${hibernate.connection.url}</value></property>
        <property name="username"><value>${hibernate.connection.username}</value></property>
        <property name="password"><value>${hibernate.connection.password}</value></property>
    </bean>

   <!-- create a SessionFactory bean from the data source and point it at our HBMs,
      name it the same as the Sakai global one so we can reuse our other spring files -->
   <bean id="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory"
      class="org.springframework.orm.hibernate4.LocalSessionFactoryBean">
      <property name="dataSource" ref="javax.sql.DataSource" />
      <property name="mappingResources" ref="evaluation.hbmMappingList" />
      <property name="hibernateProperties">
         <props>
            <prop key="hibernate.dialect">${hibernate.dialect}</prop>
            <prop key="hibernate.show_sql">${hibernate.show_sql}</prop>
            <prop key="hibernate.cache.provider_class">${hibernate.cache.provider_class}</prop>
            <prop key="hibernate.query.substitutions">true 1, false 0</prop>
            <prop key="hibernate.hbm2ddl.auto">${hibernate.hbm2ddl.auto}</prop>
         </props>
      </property>
   </bean>

   <!-- Create a transaction manager from the SessionFactory,
      name it the same as the Sakai one so we can reuse our other spring config files -->
   <bean id="org.sakaiproject.springframework.orm.hibernate.GlobalTransactionManager"
      class="org.springframework.orm.hibernate4.HibernateTransactionManager">
      <property name="sessionFactory"
         ref="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory" />
   </bean>


    <!-- Now do the TEST data preloading -->

    <!-- create a test data preloading bean -->
    <bean id="org.sakaiproject.evaluation.test.PreloadTestData"
        class="org.sakaiproject.evaluation.test.PreloadTestDataImpl" init-method="init">
        <property name="dao" ref="org.sakaiproject.evaluation.dao.EvaluationDao" />
        <property name="preloadData" ref="org.sakaiproject.evaluation.dao.PreloadData" />
    </bean>

    <!-- fake external logic bean -->
    <bean id="org.sakaiproject.evaluation.logic.externals.EvalExternalLogic"
        class="org.sakaiproject.evaluation.test.mocks.MockEvalExternalLogic">
    </bean>

    <!-- fake external hierarchy bean -->
    <bean id="org.sakaiproject.evaluation.logic.externals.ExternalHierarchyLogic"
        class="org.sakaiproject.evaluation.test.mocks.MockExternalHierarchyLogic">
    </bean>

</beans>